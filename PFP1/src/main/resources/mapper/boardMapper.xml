<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pfp.mapper.boardMapper">
	
	<!-- 게시물 총 개수 -->
	<select id="count" resultType="int">
		select count(*) from board
	</select>
	
	<!-- 게시물 목록 -->
	<select id="list" resultType="org.pfp.dto.BoardVO">
		select boardCode, userId, content, picture, tag, good, title, regiDate
		from board
	</select>
	
	<!-- 게시물 목록 + 페이 -->
	<select id="listPage" parameterType="hashMap" resultType="org.pfp.dto.BoardVO">
		select boardCode, userId, content, picture, tag, good, title, regiDate
		from board
		order by boardCode desc
		limit #{displayPost}, #{postNum}
	</select>
	
	
	
	<!-- 게시물 등록 -->
	<insert id="resist">
		insert into 
		board(userId, content, picture, tag, good, title, regiDate)
		values(#{userId}, #{content}, #{picture}, #{tag}, 0, #{title}, SYSDATE())
	</insert>
	
	<!-- 게시물 조회 -->
	<select id="view" parameterType="int" resultType="org.pfp.dto.BoardVO">
		select boardCode, userId, content, picture, tag, good, title, regiDate
		from board
		where boardCode = #{boardCode}
	</select>
	
	<!-- 블로그 댓글 작성 -->
	<insert id="registReply">
		insert into comment(boardCode, userId, commentDate, reContent)
		values (#{boardCode}, #{userId}, SYSDATE(), #{reContent})
	</insert>
	
	<!-- 블로그 댓글 목록  -->
	<select id="replyList" resultType="org.pfp.dto.ReplyVO">
		select m.nickname, r.commentDate, r.reContent, r.userId, r.commentNum, r.boardCode
		from comment r
		inner join member m
		on r.userId = m.userId
		where boardCode = #{boardCode}
	</select>
	
	<!-- 블로그 댓글 삭제  -->
	<delete id="deleteReply">
		delete 
		from comment
		where commentNum = #{commentNum}
		and userId = #{userId}
	</delete>
	
	<!-- 댓글 아이디 체크  -->
	<select id="replyUserIdCheck" resultType="String">
		select userId
		from comment
		where commentNum = #{commentNum}
	</select>
	
	<!-- 댓글 수정  -->
	<update id="modifyReply">
		update comment
		set 
		reContent = #{reContent},
		commentDate = SYSDATE()
		where commentNum = #{commentNum}
		and userId = #{userId}
	</update>
	
	<!-- 개인 블로그  -->
	<select id="personalList" resultType="org.pfp.dto.BoardVO">
	<![CDATA[
		select boardCode, userId, content, picture, tag, good, title, regiDate
		from board
		where userId = #{userId} and boardCode>0
		order by boardCode desc, regiDate desc
		limit 0,12;
		]]>
	</select>
	
	<!-- 무한 스크롤 다운  -->
	<select id="infiniteScrollDown" resultType="org.pfp.dto.BoardVO">
	<![CDATA[
		select select boardCode, userId, content, picture, tag, good, title, regiDate
		from board
		where boardCode <= #{boardCode}
		and boardCode > #{boardCode} -12
		order by boardCode desc, regiDate desc
	]]>
	</select>
</mapper>